<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.hoooosi.imagehosting.mapper.MemberMapper">
    <sql id="select">
        WITH "tb" AS (SELECT m.id,
                             m.space_id,
                             m.user_id,
                             m.permission_mask,
                             m.create_time,
                             m.update_time,
                             u.name    as name,
                             u.account as account,
                             u.avatar  as avatar
                      FROM "tb_member" m
                               LEFT JOIN "tb_user" u ON m.user_id = u.id)
        SELECT *
        FROM "tb"
    </sql>

    <select id="query" resultType="io.github.hoooosi.imagehosting.vo.MemberVO">
        <include refid="select"/>
        <where>
            <if test="ew != null and ew.sqlSegment != null and ew.sqlSegment != ''">
                ${ew.sqlSegment}
            </if>
        </where>
    </select>
</mapper>